<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>

    <!--SweetAlert2-->
    <script src="http://code.jquery.com/jquery-latest.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>


    <title>두번째 페이지</title>

    <link rel="stylesheet" href="/static/style.css" type="text/css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">

    <!--다시 퀴즈풀기-->
    <script type="text/javascript">
        function start() {
            $.ajax({
                type: "get",
                url: "/start",
                data: {},
                success: function (response) {
                    window.location.href = '/start';
                }
            })
        }
    </script>


    <script>

        $().ready(quiz_start()) //페이지 로딩하자마자 바로 quiz_start()를 실행!

        var question
        var answer1
        var answer2
        var answer3
        var answer4

        var i = 0;// 전역변수를 설정해줌으로 클릭시=quiz_stat()실행 할때 마다 i값을 차례대로 뽑음.
        var score = 0; //누적점수를 담을 변수 생성

        function quiz_start() {
            $('#main_page').empty() //화면에 나온 값을 다 지우고 새로 붙여쓰기 함
            $('#main_page').slideUp( 100, 'swing' ).delay( 1800 ).slideDown( 100, 'swing' ); //코드 설명 : 함수를불러와서 위로 슬라이드업한다(보이지않음)> 2.6초 시간 지연 > 슬라이드다운 내려옴.
            i++;

            $.ajax({
                type: "GET",
                url: "/quiz",
                data: {},
                success: function (response) {
                    let all_quiz = response['all_quiz']
                    question = all_quiz[i]['question']
                    answer1 = all_quiz[i]['answer1']
                    answer2 = all_quiz[i]['answer2']
                    answer3 = all_quiz[i]['answer3']
                    answer4 = all_quiz[i]['answer4']

                    let word = [answer1, answer2, answer3 , answer4]
                    let aa = word[Math.floor(Math.random() * word.length)]
                    let bb = word[Math.floor(Math.random() * word.length)]
                    let cc = word[Math.floor(Math.random() * word.length)]
                    let dd = word[Math.floor(Math.random() * word.length)]



                    console.log(aa,bb,cc,dd)

                    let test = `<!--문제 출제-->
                                <div class="question">
                                    <h2>${question}</h2>
                                </div>

                                <!--정답-->
                                 <div class="quiz_button">
                                    <div><button id="button1" onclick="quiz_start(); count(); check1();" type="button" class="q">${aa}</button></div>
                                    <div><button id="button2" onclick="quiz_start(); count(); check2();" type="button" class="q">${bb}</button></div>
                                    <div><button id="button3" onclick="quiz_start(); count(); check3();" type="button" class="q">${cc}</button></div>
                                    <div><button id="button4" onclick="quiz_start(); count(); check4();" type="button" class="q">${dd}</button></div>
                                 </div>`

                    $('#main_page').append(test)
                }
            })
        }

        //////////////////// 정오답 체크하기 //////////////////////
        function check1() {                                  // 첫번째 버튼
            $.ajax({
                type: "POST",
                url: "/check",
                data: {answer_click: aa},
                success: function (response) {
                    let text = response["msg"]
                    let tt = 1;
                    if (text === tt) {
                        plus_score();
                        Swal.fire({
                            icon: 'success',
                            title: "정답입니다.",
                            timerProgressBar:true,
                            timer: 1500,
                            showConfirmButton: false
                        });
                    } else {
                        Swal.fire({
                            icon: 'warning',
                            title: "오답입니다.",
                            timerProgressBar:true,
                            timer: 1500,
                            showConfirmButton: false
                        });

                    }

                }
            })
        }       //첫번째 버튼
        function check2() {                                  // 첫번째 버튼
            $.ajax({
                type: "POST",
                url: "/check",
                data: {answer_click: bb},
                success: function (response) {
                    let text = response["msg"]
                    let tt = 1;
                    if (text === tt) {
                        plus_score();
                        Swal.fire({
                            icon: 'success',
                            title: "정답입니다.",
                            timerProgressBar:true,
                            timer: 1500,
                            showConfirmButton: false
                        });
                    } else {
                        Swal.fire({
                            icon: 'warning',
                            title: "오답입니다.",
                            timerProgressBar:true,
                            timer: 1500,
                            showConfirmButton: false
                        });

                    }

                }
            })
        }       //두전째 버튼
        function check3() {                                  // 첫번째 버튼
            $.ajax({
                type: "POST",
                url: "/check",
                data: {answer_click: cc},
                success: function (response) {
                    let text = response["msg"]
                    let tt = 1;
                    if (text === tt) {
                        plus_score();
                        Swal.fire({
                            icon: 'success',
                            title: "정답입니다.",
                            timerProgressBar:true,
                            timer: 1500,
                            showConfirmButton: false
                        });
                    } else {
                        Swal.fire({
                            icon: 'warning',
                            title: "오답입니다.",
                            timerProgressBar:true,
                            timer: 1500,
                            showConfirmButton: false
                        });

                    }

                }
            })
        }       //세번째 버튼
        function check4() {                                  // 첫번째 버튼
            $.ajax({
                type: "POST",
                url: "/check",
                data: {answer_click: dd},
                success: function (response) {
                    let text = response["msg"]
                    let tt = 1;
                    if (text === tt) {
                        plus_score();
                        Swal.fire({
                            icon: 'success',
                            title: "정답입니다.",
                            timerProgressBar:true,
                            timer: 1500,
                            showConfirmButton: false
                        });
                    } else {
                        Swal.fire({
                            icon: 'warning',
                            title: "오답입니다.",
                            timerProgressBar:true,
                            timer: 1500,
                            showConfirmButton: false
                        });

                    }

                }
            })
        }       //네번째 버튼
        //////////////////// 정오답 체크하기 //////////////////////
    </script>




    <!--상단진행도-->

    <script>
        var a = 1;  //전역변수를 만들어 주어 <누적점수> 함수에 조건문 실행

        <!--문제 진행단계 상단표시-->
        function count() {
            a += 1
            document.querySelector("#result").innerText = a;

            if (a == 16) {
                result()
            }
        }

        <!--결과페이지 이동 -->
        function result() {
            $.ajax({
                type: "get",
                url: "/result",
                data: {},
                success: function (response) {
                    window.location.href='/result'
                }
            })
        }

        <!--누적점수-->
        function plus_score(){
            score += 1
            if (a==16){
                $.ajax({
                type: "post",
                url: "/score",
                data: {score_post:score},
                success: function (response) {
                     let a = response["msg"]
                    console.log(a)
                }
            })
            }
        }


    </script>


    <script>
            if (document.querySelector('#result').innerText == 2) {
                setTimeout(() => resultpage(), 2000)
            }
        }

        function resultpage() {
            $.ajax({
                type: "get",
                url: "/result",
                data: {},
                success: function (response) {
                    window.location.href = '/result';
                }
            })
        }
    </script>

</head>


<body>

<!--main layout-->
<div class="container">


    <!--퀴즈 헤드라인-->
    <div class="quiz_head">
        <span class="head">Quiz</span>
        <span class="head" id="result">1</span>
        <span class="head">/15</span>
    </div>

    <!--main_page-->
    <div id="main_page" class="main_page">

        <!--문제 출제-->
        <div class="question">

        </div>
    </div>

    <!--restart-->
    <div onclick="start()" class="start_button">
        <button type="button" class="btn btn-warning">다시 시작하기</button>
    </div>

</div>

</body>

</html>

